<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>模型管理 - MAG SDK 使用文档</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #fafafa;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* 侧边栏样式 */
        .sidebar {
            width: 280px;
            background: #fff;
            border-right: 1px solid #e1e5e9;
            padding: 20px 0;
            overflow-y: auto;
            position: fixed;
            height: 100vh;
            z-index: 1000;
        }

        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid #e1e5e9;
            margin-bottom: 20px;
        }

        .logo h1 {
            color: #2563eb;
            font-size: 24px;
            font-weight: 700;
        }

        .logo p {
            color: #6b7280;
            font-size: 14px;
            margin-top: 5px;
        }

        .nav {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            color: #4b5563;
            text-decoration: none;
            transition: all 0.2s;
            border-right: 3px solid transparent;
        }

        .nav-link:hover {
            background-color: #f3f4f6;
            color: #2563eb;
        }

        .nav-link.active {
            background-color: #eff6ff;
            color: #2563eb;
            border-right-color: #2563eb;
        }

        .nav-link i {
            margin-right: 10px;
            width: 16px;
        }

        /* 折叠菜单样式 */
        .nav-group {
            margin-bottom: 10px;
        }

        .nav-group-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 20px;
            color: #374151;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-group-title:hover {
            background-color: #f9fafb;
            color: #2563eb;
        }

        .nav-group-title.active {
            background-color: #eff6ff;
            color: #2563eb;
        }

        .nav-group-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .nav-group-content .nav-link {
            padding-left: 50px;
            font-size: 14px;
        }

        .chevron {
            transition: transform 0.3s ease;
            transform: rotate(90deg);
        }

        /* 主内容区域 */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 40px 60px;
            background: #fff;
            min-height: 100vh;
        }

        /* 页面头部 */
        .page-header {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .page-header h1 {
            color: #1f2937;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .page-header p {
            color: #6b7280;
            font-size: 1.1rem;
        }

        /* 内容区块 */
        .section {
            margin-bottom: 50px;
        }

        .section h2 {
            color: #1f2937;
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h3 {
            color: #374151;
            font-size: 1.3rem;
            margin: 30px 0 15px;
        }

        .section p {
            color: #6b7280;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        /* 代码块样式 */
        .code-block {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow-x: auto;
        }

        .code-block pre {
            margin: 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4b5563;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #6b7280;
        }

        /* 功能卡片 */
        .function-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            transition: all 0.3s ease;
        }

        .function-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .function-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .function-icon {
            background: #2563eb;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5rem;
        }

        .function-title {
            color: #1f2937;
            font-size: 1.4rem;
            font-weight: 600;
        }

        /* 参数表格 */
        .param-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .param-table th,
        .param-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .param-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        .param-table tr:last-child td {
            border-bottom: none;
        }

        /* 返回值样式 */
        .return-value {
            background: #ecfdf5;
            border: 1px solid #a7f3d0;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .return-value h4 {
            color: #065f46;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .return-value p {
            color: #047857;
            margin: 0;
        }

        /* 注意事项 */
        .note {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .note h4 {
            color: #92400e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .note p {
            color: #b45309;
            margin: 0;
        }

        /* 目录导航 */
        .toc {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .toc h3 {
            color: #374151;
            margin-bottom: 15px;
        }

        .toc ul {
            list-style: none;
            padding: 0;
        }

        .toc li {
            margin: 8px 0;
        }

        .toc a {
            color: #2563eb;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .toc a:hover {
            background: #eff6ff;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .page-header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 侧边栏 -->
        <nav class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-project-diagram"></i> MAG SDK</h1>
                <p>MCP Agent Graph 开发框架</p>
            </div>
            
            <ul class="nav">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        概述
                    </a>
                </li>
                
                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-cog"></i> 系统管理</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="system.html#system-start" class="nav-link">
                            <i class="fas fa-play"></i>
                            启动服务
                        </a>
                        <a href="system.html#system-status" class="nav-link">
                            <i class="fas fa-info-circle"></i>
                            状态检查
                        </a>
                        <a href="system.html#system-shutdown" class="nav-link">
                            <i class="fas fa-stop"></i>
                            关闭服务
                        </a>
                    </div>
                </li>

                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-project-diagram"></i> 图管理</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="graph.html#graph-list" class="nav-link">列出图</a>
                        <a href="graph.html#graph-get" class="nav-link">获取图</a>
                        <a href="graph.html#graph-save" class="nav-link">保存图</a>
                        <a href="graph.html#graph-delete" class="nav-link">删除图</a>
                        <a href="graph.html#graph-run" class="nav-link">运行图</a>
                        <a href="graph.html#graph-import" class="nav-link">导入图</a>
                        <a href="graph.html#graph-export" class="nav-link">导出图</a>
                        <a href="graph.html#graph-mcp" class="nav-link">生成MCP脚本</a>
                    </div>
                </li>

                <li class="nav-group">
                    <div class="nav-group-title active">
                        <span><i class="fas fa-brain"></i> 模型管理</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content">
                        <a href="#model-list" class="nav-link active">列出模型</a>
                        <a href="#model-get" class="nav-link">获取模型</a>
                        <a href="#model-add" class="nav-link">添加模型</a>
                        <a href="#model-update" class="nav-link">更新模型</a>
                        <a href="#model-delete" class="nav-link">删除模型</a>
                    </div>
                </li>

                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-server"></i> MCP管理</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="mcp.html#mcp-config" class="nav-link">配置管理</a>
                        <a href="mcp.html#mcp-status" class="nav-link">状态查看</a>
                        <a href="mcp.html#mcp-connect" class="nav-link">连接服务器</a>
                        <a href="mcp.html#mcp-tools" class="nav-link">工具管理</a>
                        <a href="mcp.html#mcp-servers" class="nav-link">服务器管理</a>
                    </div>
                </li>

                <li class="nav-group">
                    <div class="nav-group-title">
                        <span><i class="fas fa-comments"></i> 会话管理</span>
                        <i class="fas fa-chevron-right chevron"></i>
                    </div>
                    <div class="nav-group-content" style="max-height: 0;">
                        <a href="conversation.html#conversation-list" class="nav-link">列出会话</a>
                        <a href="conversation.html#conversation-get" class="nav-link">获取会话</a>
                        <a href="conversation.html#conversation-delete" class="nav-link">删除会话</a>
                    </div>
                </li>

                <li class="nav-item">
                    <a href="examples.html" class="nav-link">
                        <i class="fas fa-code"></i>
                        示例教程
                    </a>
                </li>
            </ul>
        </nav>

        <!-- 主内容区域 -->
        <main class="main-content">
            <div class="page-header">
                <h1><i class="fas fa-brain"></i> 模型管理</h1>
                <p>AI模型的配置、管理和维护</p>
            </div>

            <!-- 目录导航 -->
            <div class="toc">
                <h3><i class="fas fa-list"></i> 本页内容</h3>
                <ul>
                    <li><a href="#model-list">列出模型 - mag.list_models()</a></li>
                    <li><a href="#model-get">获取模型 - mag.get_model()</a></li>
                    <li><a href="#model-add">添加模型 - mag.add_model()</a></li>
                    <li><a href="#model-update">更新模型 - mag.update_model()</a></li>
                    <li><a href="#model-delete">删除模型 - mag.delete_model()</a></li>
                </ul>
            </div>

            <!-- 列出模型 -->
            <section class="section" id="model-list">
                <div class="function-card">
                    <div class="function-header">
                        <div class="function-icon">
                            <i class="fas fa-list"></i>
                        </div>
                        <div class="function-title">mag.list_models()</div>
                    </div>
                    
                    <p>获取系统中所有已配置的AI模型列表。返回模型的基本信息，但不包含敏感的API密钥。</p>

                    <h3>函数签名</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">def list_models() -> List[Dict[str, Any]]:
    """
    获取所有模型
    
    返回:
        List[Dict[str, Any]]: 模型配置列表
    """</code></pre>
                    </div>

                    <h3>返回值</h3>
                    <div class="return-value">
                        <h4><i class="fas fa-check-circle"></i> 返回值说明</h4>
                        <p><strong>List[Dict[str, Any]]</strong> - 包含所有模型配置的列表，每个模型包含name、base_url、model等字段</p>
                    </div>

                    <h3>使用示例</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">import mag

# 启动服务
mag.start()

# 获取所有模型列表
models = mag.list_models()
print(f"系统中共有 {len(models)} 个模型:")

for i, model in enumerate(models, 1):
    print(f"\n{i}. {model['name']}")
    print(f"   基础URL: {model['base_url']}")
    print(f"   模型标识: {model['model']}")
    print(f"   API密钥: {'已配置' if model.get('api_key') else '未配置'}")

# 示例输出:
# 系统中共有 3 个模型:
# 
# 1. gpt-4
#    基础URL: https://api.openai.com/v1/
#    模型标识: gpt-4
#    API密钥: 已配置
# 
# 2. deepseek-chat
#    基础URL: https://gateway.ai.cloudflare.com/v1/.../deepseek/
#    模型标识: deepseek-chat
#    API密钥: 已配置
</code></pre>
                    </div>

                    <h3>按类型分组显示</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">def display_models_by_provider():
    """按提供商分组显示模型"""
    models = mag.list_models()
    
    # 按提供商分组
    providers = {}
    for model in models:
        # 根据base_url推断提供商
        if 'openai.com' in model['base_url']:
            provider = 'OpenAI'
        elif 'deepseek' in model['base_url']:
            provider = 'DeepSeek'
        elif 'anthropic' in model['base_url']:
            provider = 'Anthropic'
        else:
            provider = '其他'
        
        if provider not in providers:
            providers[provider] = []
        providers[provider].append(model)
    
    # 显示分组结果
    for provider, provider_models in providers.items():
        print(f"\n📡 {provider} ({len(provider_models)} 个模型):")
        for model in provider_models:
            print(f"  • {model['name']} - {model['model']}")

# 使用分组显示
display_models_by_provider()
</code></pre>
                    </div>
                </div>
            </section>

            <!-- 获取模型 -->
            <section class="section" id="model-get">
                <div class="function-card">
                    <div class="function-header">
                        <div class="function-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="function-title">mag.get_model()</div>
                    </div>
                    
                    <p>获取指定模型的详细配置信息。</p>

                    <h3>函数签名</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">def get_model(name: str) -> Optional[Dict[str, Any]]:
    """
    获取指定模型的配置
    
    参数:
        name (str): 模型名称
    
    返回:
        Optional[Dict[str, Any]]: 模型配置，如果不存在则返回None
    """</code></pre>
                    </div>

                    <h3>使用示例</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">import mag

# 获取特定模型信息
model_info = mag.get_model("gpt-4")

if model_info:
    print("模型详细信息:")
    print(f"名称: {model_info['name']}")
    print(f"基础URL: {model_info['base_url']}")
    print(f"模型: {model_info['model']}")
    print(f"API密钥状态: {'已配置' if model_info.get('api_key') else '未配置'}")
else:
    print("模型不存在")
</code></pre>
                    </div>
                </div>
            </section>

            <!-- 添加模型 -->
            <section class="section" id="model-add">
                <div class="function-card">
                    <div class="function-header">
                        <div class="function-icon">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="function-title">mag.add_model()</div>
                    </div>
                    
                    <p>添加新的AI模型配置到系统中。模型配置完成后即可在图中使用。</p>

                    <h3>函数签名</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">def add_model(config: Dict[str, Any]) -> Dict[str, Any]:
    """
    添加新模型
    
    参数:
        config (Dict[str, Any]): 模型配置，必须包含以下字段:
            - name: 模型名称
            - base_url: API基础URL
            - api_key: API密钥
            - model: 模型标识符
    
    返回:
        Dict[str, Any]: 操作结果
    """</code></pre>
                    </div>

                    <h3>参数说明</h3>
                    <table class="param-table">
                        <thead>
                            <tr>
                                <th>字段名</th>
                                <th>类型</th>
                                <th>必需</th>
                                <th>说明</th>
                                <th>示例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>name</td>
                                <td>str</td>
                                <td>是</td>
                                <td>模型的唯一名称标识</td>
                                <td>"gpt-4", "deepseek-chat"</td>
                            </tr>
                            <tr>
                                <td>base_url</td>
                                <td>str</td>
                                <td>是</td>
                                <td>API服务的基础URL</td>
                                <td>"https://api.openai.com/v1/"</td>
                            </tr>
                            <tr>
                                <td>api_key</td>
                                <td>str</td>
                                <td>是</td>
                                <td>访问API的密钥</td>
                                <td>"sk-..."</td>
                            </tr>
                            <tr>
                                <td>model</td>
                                <td>str</td>
                                <td>是</td>
                                <td>API中的模型标识符</td>
                                <td>"gpt-4", "deepseek-chat"</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>使用示例</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">import mag

# 添加OpenAI GPT-4模型
openai_model = {
    "name": "gpt-4",
    "base_url": "https://api.openai.com/v1/",
    "api_key": "sk-your-openai-api-key-here",
    "model": "gpt-4"
}

result = mag.add_model(openai_model)
print(f"OpenAI模型添加结果: {result}")

# 添加DeepSeek模型
deepseek_model = {
    "name": "deepseek-chat",
    "base_url": "https://gateway.ai.cloudflare.com/v1/your-id/deepseek/",
    "api_key": "sk-your-deepseek-api-key",
    "model": "deepseek-chat"
}

result = mag.add_model(deepseek_model)
print(f"DeepSeek模型添加结果: {result}")

# 添加本地模型（如Ollama）
local_model = {
    "name": "llama2-local",
    "base_url": "http://localhost:11434/v1/",
    "api_key": "not-needed",  # 本地模型可能不需要API密钥
    "model": "llama2"
}

result = mag.add_model(local_model)
print(f"本地模型添加结果: {result}")
</code></pre>
                    </div>

                    <h3>批量添加模型</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">def batch_add_models(models_config):
    """批量添加模型"""
    results = []
    
    for model_config in models_config:
        try:
            result = mag.add_model(model_config)
            results.append({
                "name": model_config["name"],
                "status": "success" if result.get("status") == "success" else "failed",
                "message": result.get("message", "")
            })
            print(f"✅ 模型 '{model_config['name']}' 添加成功")
        except Exception as e:
            results.append({
                "name": model_config["name"],
                "status": "error",
                "message": str(e)
            })
            print(f"❌ 模型 '{model_config['name']}' 添加失败: {e}")
    
    return results

# 准备多个模型配置
models_to_add = [
    {
        "name": "gpt-3.5-turbo",
        "base_url": "https://api.openai.com/v1/",
        "api_key": "your-openai-key",
        "model": "gpt-3.5-turbo"
    },
    {
        "name": "claude-3-sonnet",
        "base_url": "https://api.anthropic.com/",
        "api_key": "your-anthropic-key",
        "model": "claude-3-sonnet-20240229"
    }
]

# 批量添加
batch_results = batch_add_models(models_to_add)
print(f"\n批量添加完成，成功: {sum(1 for r in batch_results if r['status'] == 'success')} 个")
</code></pre>
                    </div>

                    <div class="note">
                        <h4><i class="fas fa-exclamation-triangle"></i> 安全提示</h4>
                        <p>• API密钥是敏感信息，请妥善保管<br>
                        • 不要在代码中硬编码API密钥<br>
                        • 建议使用环境变量或配置文件管理API密钥<br>
                        • 模型名称必须是唯一的</p>
                    </div>
                </div>
            </section>

            <!-- 更新模型 -->
            <section class="section" id="model-update">
                <div class="function-card">
                    <div class="function-header">
                        <div class="function-icon">
                            <i class="fas fa-edit"></i>
                        </div>
                        <div class="function-title">mag.update_model()</div>
                    </div>
                    
                    <p>更新现有模型的配置信息，如API密钥更换、URL变更等。</p>

                    <h3>函数签名</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">def update_model(name: str, config: Dict[str, Any]) -> Dict[str, Any]:
    """
    更新现有模型
    
    参数:
        name (str): 当前模型名称
        config (Dict[str, Any]): 更新后的模型配置
    
    返回:
        Dict[str, Any]: 操作结果
    """</code></pre>
                    </div>

                    <h3>参数说明</h3>
                    <table class="param-table">
                        <thead>
                            <tr>
                                <th>参数名</th>
                                <th>类型</th>
                                <th>必需</th>
                                <th>说明</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>name</td>
                                <td>str</td>
                                <td>是</td>
                                <td>要更新的模型名称</td>
                            </tr>
                            <tr>
                                <td>config</td>
                                <td>Dict[str, Any]</td>
                                <td>是</td>
                                <td>新的模型配置，包含所有必需字段</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>使用示例</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">import mag

# 更新模型配置
updated_config = {
    "name": "gpt-4",  # 可以保持不变或修改名称
    "base_url": "https://api.openai.com/v1/",
    "api_key": "sk-new-api-key-here",  # 更新API密钥
    "model": "gpt-4-turbo"  # 更新模型版本
}

result = mag.update_model("gpt-4", updated_config)
print(f"模型更新结果: {result}")

# 仅更新API密钥
def update_api_key(model_name, new_api_key):
    """仅更新模型的API密钥"""
    # 先获取当前配置
    current_config = mag.get_model(model_name)
    
    if not current_config:
        print(f"模型 '{model_name}' 不存在")
        return False
    
    # 更新API密钥
    current_config["api_key"] = new_api_key
    
    # 保存更新
    result = mag.update_model(model_name, current_config)
    
    if result.get("status") == "success":
        print(f"✅ 模型 '{model_name}' 的API密钥已更新")
        return True
    else:
        print(f"❌ 更新失败: {result.get('message', 'Unknown error')}")
        return False

# 使用API密钥更新函数
update_api_key("deepseek-chat", "sk-new-deepseek-key")
</code></pre>
                    </div>

                    <h3>模型重命名</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">def rename_model(old_name, new_name):
    """重命名模型"""
    # 获取当前配置
    current_config = mag.get_model(old_name)
    
    if not current_config:
        print(f"模型 '{old_name}' 不存在")
        return False
    
    # 检查新名称是否已存在
    if mag.get_model(new_name):
        print(f"模型名称 '{new_name}' 已存在")
        return False
    
    # 更新名称
    current_config["name"] = new_name
    
    # 更新模型（这会创建新名称的模型）
    result = mag.update_model(old_name, current_config)
    
    if result.get("status") == "success":
        print(f"✅ 模型已从 '{old_name}' 重命名为 '{new_name}'")
        return True
    else:
        print(f"❌ 重命名失败: {result.get('message', 'Unknown error')}")
        return False

# 重命名模型
rename_model("old-model-name", "new-model-name")
</code></pre>
                    </div>
                </div>
            </section>

            <!-- 删除模型 -->
            <section class="section" id="model-delete">
                <div class="function-card">
                    <div class="function-header">
                        <div class="function-icon">
                            <i class="fas fa-trash"></i>
                        </div>
                        <div class="function-title">mag.delete_model()</div>
                    </div>
                    
                    <p>从系统中删除指定的模型配置。删除后该模型将无法在图中使用。</p>

                    <h3>函数签名</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">def delete_model(name: str) -> Dict[str, Any]:
    """
    删除模型
    
    参数:
        name (str): 模型名称
    
    返回:
        Dict[str, Any]: 操作结果
    """</code></pre>
                    </div>

                    <h3>使用示例</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">import mag

# 删除模型
result = mag.delete_model("old-model")
print(f"删除结果: {result}")

# 安全删除（带确认）
def safe_delete_model(model_name):
    """安全地删除模型，包含确认步骤"""
    # 检查模型是否存在
    model_config = mag.get_model(model_name)
    if not model_config:
        print(f"模型 '{model_name}' 不存在")
        return False
    
    # 显示模型信息
    print(f"即将删除模型: {model_name}")
    print(f"基础URL: {model_config['base_url']}")
    print(f"模型标识: {model_config['model']}")
    
    # TODO: 检查是否有图正在使用此模型
    # graphs_using_model = find_graphs_using_model(model_name)
    # if graphs_using_model:
    #     print(f"警告: 以下图正在使用此模型: {graphs_using_model}")
    
    # 确认删除
    confirm = input("确认删除此模型? (yes/no): ")
    if confirm.lower() == 'yes':
        result = mag.delete_model(model_name)
        if result.get("status") == "success":
            print(f"✅ 模型 '{model_name}' 已删除")
            return True
        else:
            print(f"❌ 删除失败: {result.get('message', 'Unknown error')}")
            return False
    else:
        print("取消删除操作")
        return False

# 使用安全删除
safe_delete_model("test-model")
</code></pre>
                    </div>

                    <h3>批量删除模型</h3>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <pre><code class="language-python">def batch_delete_models(model_names, confirm=True):
    """批量删除模型"""
    if confirm:
        print(f"即将删除 {len(model_names)} 个模型:")
        for name in model_names:
            print(f"  - {name}")
        
        confirm_input = input("确认批量删除? (yes/no): ")
        if confirm_input.lower() != 'yes':
            print("取消批量删除操作")
            return
    
    results = []
    for model_name in model_names:
        try:
            result = mag.delete_model(model_name)
            if result.get("status") == "success":
                print(f"✅ 删除 '{model_name}' 成功")
                results.append({"name": model_name, "status": "success"})
            else:
                print(f"❌ 删除 '{model_name}' 失败: {result.get('message', 'Unknown error')}")
                results.append({"name": model_name, "status": "failed", "message": result.get('message', '')})
        except Exception as e:
            print(f"❌ 删除 '{model_name}' 出错: {e}")
            results.append({"name": model_name, "status": "error", "message": str(e)})
    
    successful = sum(1 for r in results if r["status"] == "success")
    print(f"\n批量删除完成: 成功 {successful}/{len(model_names)} 个")
    return results

# 批量删除测试模型
test_models = ["test-model-1", "test-model-2", "old-model"]
batch_delete_models(test_models)
</code></pre>
                    </div>

                    <div class="note">
                        <h4><i class="fas fa-exclamation-triangle"></i> 删除注意事项</h4>
                        <p>• 删除操作不可逆，请谨慎操作<br>
                        • 删除前建议检查是否有图正在使用该模型<br>
                        • 建议在删除前备份模型配置<br>
                        • 删除模型不会影响已完成的会话记录</p>
                    </div>
                </div>
            </section>

            <!-- 模型管理最佳实践 -->
            <section class="section">
                <h2><i class="fas fa-lightbulb"></i> 最佳实践</h2>

                <h3>API密钥管理</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
                    <pre><code class="language-python">import os
import mag

# 使用环境变量管理API密钥
def add_model_with_env_key(model_name, base_url, model_id, env_key_name):
    """使用环境变量中的API密钥添加模型"""
    api_key = os.getenv(env_key_name)
    
    if not api_key:
        print(f"错误: 环境变量 {env_key_name} 未设置")
        return False
    
    model_config = {
        "name": model_name,
        "base_url": base_url,
        "api_key": api_key,
        "model": model_id
    }
    
    result = mag.add_model(model_config)
    return result.get("status") == "success"

# 使用示例
# 设置环境变量: export OPENAI_API_KEY="sk-your-key"
add_model_with_env_key(
    model_name="gpt-4-env",
    base_url="https://api.openai.com/v1/",
    model_id="gpt-4",
    env_key_name="OPENAI_API_KEY"
)
</code></pre>
                </div>

                <h3>模型配置备份与恢复</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
                    <pre><code class="language-python">import json
import mag
from datetime import datetime

def backup_models(backup_file=None):
    """备份所有模型配置"""
    if not backup_file:
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_file = f"models_backup_{timestamp}.json"
    
    models = mag.list_models()
    
    # 备份时移除敏感的API密钥
    safe_models = []
    for model in models:
        safe_model = model.copy()
        safe_model["api_key"] = "*** REMOVED FOR BACKUP ***"
        safe_models.append(safe_model)
    
    with open(backup_file, 'w', encoding='utf-8') as f:
        json.dump(safe_models, f, indent=2, ensure_ascii=False)
    
    print(f"✅ 模型配置已备份到: {backup_file}")
    print(f"备份了 {len(safe_models)} 个模型")
    return backup_file

def restore_models_structure(backup_file):
    """从备份文件恢复模型结构（需要手动设置API密钥）"""
    try:
        with open(backup_file, 'r', encoding='utf-8') as f:
            models = json.load(f)
        
        print(f"从备份文件 {backup_file} 读取到 {len(models)} 个模型")
        print("注意: 需要手动设置API密钥")
        
        for model in models:
            print(f"\n模型: {model['name']}")
            print(f"基础URL: {model['base_url']}")
            print(f"模型标识: {model['model']}")
            print("请手动设置API密钥后调用 mag.add_model()")
        
        return models
    except Exception as e:
        print(f"恢复备份失败: {e}")
        return None

# 备份模型
backup_file = backup_models()

# 查看备份内容
models_structure = restore_models_structure(backup_file)
</code></pre>
                </div>
            </section>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script>
        // 复制代码功能
        function copyCode(button) {
            const code = button.nextElementSibling.textContent;
            navigator.clipboard.writeText(code).then(() => {
                const originalText = button.textContent;
                button.textContent = '已复制!';
                button.style.background = '#10b981';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#4b5563';
                }, 2000);
            });
        }

        // 导航链接点击处理
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                // 移除其他活动状态
                document.querySelectorAll('.nav-link.active').forEach(el => {
                    el.classList.remove('active');
                });
                // 添加活动状态到当前链接
                e.target.classList.add('active');
            });
        });

        // 页面内锚点滚动
        document.querySelectorAll('a[href^="#"]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const target = document.querySelector(link.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // 代码高亮
        Prism.highlightAll();
    </script>
</body>
</html>